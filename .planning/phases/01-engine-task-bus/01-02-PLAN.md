---
phase: 01-engine-task-bus
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/dashboard/frontend/src/App.tsx
  - src/dashboard/frontend/src/pages/DashboardPage.tsx
  - src/dashboard/frontend/src/pages/ChatPage.tsx
  - src/dashboard/frontend/src/pages/TasksPage.tsx
  - src/dashboard/frontend/src/components/layout/AppShell.tsx
  - src/dashboard/frontend/src/components/layout/Sidebar.tsx
  - src/dashboard/frontend/src/hooks/useEngine.ts
  - src/dashboard/frontend/src/hooks/useSession.ts
  - src/dashboard/frontend/src/lib/api.ts
  - src/dashboard/frontend/package.json
autonomous: true

must_haves:
  truths:
    - "User opens app and sees dashboard overview page"
    - "User can navigate between Dashboard, Chat, and Tasks pages"
    - "Sidebar shows navigation with active page highlight"
    - "API hooks can fetch data from backend"
  artifacts:
    - path: "src/dashboard/frontend/src/components/layout/AppShell.tsx"
      provides: "Root layout with sidebar + main content area"
      min_lines: 40
    - path: "src/dashboard/frontend/src/components/layout/Sidebar.tsx"
      provides: "Navigation sidebar with page links"
      min_lines: 30
    - path: "src/dashboard/frontend/src/pages/DashboardPage.tsx"
      provides: "Dashboard overview page (placeholder for now)"
      min_lines: 20
    - path: "src/dashboard/frontend/src/pages/ChatPage.tsx"
      provides: "Chat page (placeholder for now)"
      min_lines: 20
    - path: "src/dashboard/frontend/src/hooks/useEngine.ts"
      provides: "React hooks for engine API calls"
      min_lines: 20
    - path: "src/dashboard/frontend/src/lib/api.ts"
      provides: "API client for backend communication"
      min_lines: 30
  key_links:
    - from: "src/dashboard/frontend/src/App.tsx"
      to: "react-router-dom"
      via: "BrowserRouter + Routes"
      pattern: "BrowserRouter|Routes|Route"
    - from: "src/dashboard/frontend/src/lib/api.ts"
      to: "backend /api/*"
      via: "fetch calls to backend"
      pattern: "fetch.*api/"
    - from: "src/dashboard/frontend/src/hooks/useEngine.ts"
      to: "src/dashboard/frontend/src/lib/api.ts"
      via: "useQuery wrapping API calls"
      pattern: "useQuery|useMutation"
---

<objective>
Create the frontend app shell with routing, navigation, and API layer.

Purpose: Establishes the page structure and data-fetching foundation. All subsequent UI plans (chat, tasks, governance) slot into this shell. Dashboard-first landing per user decision.

Output: React Router setup, AppShell layout with sidebar, page placeholders (Dashboard/Chat/Tasks), API client, React Query hooks.
</objective>

<execution_context>
@/Users/apple/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/apple/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-engine-task-bus/01-RESEARCH.md
@src/dashboard/frontend/src/App.tsx
@src/dashboard/frontend/package.json
@src/dashboard/frontend/src/components/layout/DashboardLayout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Dependencies + Create API Layer + Hooks</name>
  <files>src/dashboard/frontend/package.json, src/dashboard/frontend/src/lib/api.ts, src/dashboard/frontend/src/hooks/useEngine.ts, src/dashboard/frontend/src/hooks/useSession.ts</files>
  <action>
**Install react-router-dom:**
```bash
cd src/dashboard/frontend && npm install react-router-dom
```

**Create `src/dashboard/frontend/src/lib/api.ts`:**
API client singleton with typed methods. Use the backend URL from environment or default to `http://localhost:3001`.

```typescript
const API_BASE = import.meta.env.VITE_API_URL || "http://localhost:3001"

export const api = {
  // Engine
  getEngineStatus: () => fetch(`${API_BASE}/api/engine/status`).then(r => r.json()),

  // Sessions
  listSessions: () => fetch(`${API_BASE}/api/sessions`).then(r => r.json()),
  createSession: () => fetch(`${API_BASE}/api/sessions`, { method: "POST" }).then(r => r.json()),
  getSession: (id: string) => fetch(`${API_BASE}/api/sessions/${id}`).then(r => r.json()),
  deleteSession: (id: string) => fetch(`${API_BASE}/api/sessions/${id}`, { method: "DELETE" }),
  getMessages: (id: string) => fetch(`${API_BASE}/api/sessions/${id}/messages`).then(r => r.json()),
  getSessionStatus: (id: string) => fetch(`${API_BASE}/api/sessions/${id}/status`).then(r => r.json()),
  getSessionChildren: (id: string) => fetch(`${API_BASE}/api/sessions/${id}/children`).then(r => r.json()),
  sendPrompt: (id: string, text: string) => // Returns EventSource URL for streaming
    `${API_BASE}/api/sessions/${id}/prompt`,
  abortSession: (id: string) => fetch(`${API_BASE}/api/sessions/${id}/abort`, { method: "POST" }),

  // Governance (existing endpoints)
  getTasks: () => fetch(`${API_BASE}/api/tasks`).then(r => r.json()),
  getBrain: () => fetch(`${API_BASE}/api/brain`).then(r => r.json()),
  getDelegations: () => fetch(`${API_BASE}/api/delegations`).then(r => r.json()),

  // SSE
  eventsUrl: `${API_BASE}/api/events`,
}
```

**Create `src/dashboard/frontend/src/hooks/useEngine.ts`:**
Tanstack Query hooks for engine state:
- `useEngineStatus()` — polls `/api/engine/status` every 10s
- `useSessions()` — fetches session list, refetch on `session.created` / `session.deleted` events
- `useCreateSession()` — mutation that creates a session and invalidates session list
- `useDeleteSession()` — mutation that deletes a session

**Create `src/dashboard/frontend/src/hooks/useSession.ts`:**
Hooks for individual session state:
- `useSession(id: string)` — fetches session details
- `useMessages(id: string)` — fetches message history for a session
- `useSessionStatus(id: string)` — polls session status (idle/running/compacting) every 2s when running
  </action>
  <verify>
`cd src/dashboard/frontend && npx tsc --noEmit` — zero errors. `react-router-dom` in `node_modules`.
  </verify>
  <done>
API client provides typed methods for all backend endpoints. React Query hooks wrap session and engine operations. react-router-dom installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AppShell Layout + Sidebar + Page Routing</name>
  <files>src/dashboard/frontend/src/components/layout/AppShell.tsx, src/dashboard/frontend/src/components/layout/Sidebar.tsx, src/dashboard/frontend/src/pages/DashboardPage.tsx, src/dashboard/frontend/src/pages/ChatPage.tsx, src/dashboard/frontend/src/pages/TasksPage.tsx, src/dashboard/frontend/src/App.tsx</files>
  <action>
**Create `src/dashboard/frontend/src/components/layout/Sidebar.tsx`:**
Vertical navigation sidebar using Tailwind. Contains:
- App title/logo area at top ("iDumb" branding)
- Nav links: Dashboard (LayoutDashboard icon), Chat (MessageSquare icon), Tasks (CheckSquare icon) — use `lucide-react` icons
- Active link highlight using `useLocation()` from react-router-dom
- Bottom section: settings gear icon, engine status indicator (green dot if running, red if not) using `useEngineStatus()` hook
- Width: `w-60` on desktop, collapsible on mobile
- Styling: dark sidebar (`bg-zinc-950 text-zinc-300`), subtle hover states

**Create `src/dashboard/frontend/src/components/layout/AppShell.tsx`:**
Root layout component:
- Sidebar on the left (fixed position)
- Main content area with `<Outlet />` for route rendering
- Full viewport height (`h-screen`)
- Responsive: sidebar collapses to icon-only on small screens
- Wrap children in `QueryClientProvider` (Tanstack Query)

**Create page placeholders (each ~30-50 lines):**

`src/dashboard/frontend/src/pages/DashboardPage.tsx`:
- Title "Dashboard"
- Three placeholder cards: "Active Tasks" (count), "Recent Conversations" (count), "Project Health" (grade)
- Uses existing Card component from shadcn/ui
- Fetches engine status and session count from hooks

`src/dashboard/frontend/src/pages/ChatPage.tsx`:
- Title "Chat"
- Session list on the left (narrow panel)
- Main chat area with "Select a session or start a new one" placeholder
- "New Chat" button that calls `useCreateSession()`
- Uses `useParams()` for optional session ID in URL

`src/dashboard/frontend/src/pages/TasksPage.tsx`:
- Title "Tasks"
- Placeholder: "Task management coming soon"
- Shows task count from governance API if available

**Update `src/dashboard/frontend/src/App.tsx`:**
Replace current content with React Router setup:
```tsx
import { BrowserRouter, Routes, Route, Navigate } from "react-router-dom"
import { QueryClient, QueryClientProvider } from "@tanstack/react-query"
import { AppShell } from "./components/layout/AppShell"
import { DashboardPage } from "./pages/DashboardPage"
import { ChatPage } from "./pages/ChatPage"
import { TasksPage } from "./pages/TasksPage"

const queryClient = new QueryClient()

export function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
        <Routes>
          <Route element={<AppShell />}>
            <Route path="/" element={<DashboardPage />} />
            <Route path="/chat" element={<ChatPage />} />
            <Route path="/chat/:sessionId" element={<ChatPage />} />
            <Route path="/tasks" element={<TasksPage />} />
            <Route path="/tasks/:taskId" element={<TasksPage />} />
            <Route path="*" element={<Navigate to="/" replace />} />
          </Route>
        </Routes>
      </BrowserRouter>
    </QueryClientProvider>
  )
}
```

Per user decision: Dashboard-first landing (root `/` goes to DashboardPage, not Chat).
  </action>
  <verify>
`cd src/dashboard/frontend && npm run build` succeeds. Open in browser — sidebar renders, navigation between pages works, dashboard shows placeholder cards.
  </verify>
  <done>
App shell renders with sidebar navigation. Three pages accessible via routing. Dashboard is the landing page per user decision. Engine status indicator visible in sidebar.
  </done>
</task>

</tasks>

<verification>
1. `cd src/dashboard/frontend && npx tsc --noEmit` — zero TypeScript errors
2. `cd src/dashboard/frontend && npm run build` — Vite build succeeds
3. Navigate to `/` — sees Dashboard page with placeholder cards
4. Navigate to `/chat` — sees Chat page with session list and new chat button
5. Navigate to `/tasks` — sees Tasks page placeholder
6. Sidebar highlights active page
7. Engine status indicator shows green/red dot
</verification>

<success_criteria>
- Three-page app with working React Router navigation
- Sidebar navigation with active state highlighting
- API client and React Query hooks ready for data fetching
- Dashboard-first landing page (per user decision)
- Vite build passes, zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-engine-task-bus/01-02-SUMMARY.md`
</output>
