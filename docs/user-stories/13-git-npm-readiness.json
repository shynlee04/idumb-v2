[
  {
    "description": "Define and execute branch consolidation: merge dev into main as the single source of truth, abandon master as a stale branch, update GitHub default branch if needed",
    "steps": [
      "Create a backup branch from current main: git branch main-backup-pre-merge",
      "Create a backup branch from current dev: git branch dev-backup-pre-merge",
      "Determine merge strategy: since main and dev are fully diverged (1502 files, 428K insertions), a force-push of dev to main is cleaner than a merge",
      "Execute: git checkout main && git reset --hard dev (makes main identical to dev)",
      "Push main to origin: git push origin main --force-with-lease",
      "Verify GitHub default branch is set to main (or change it via GitHub settings)",
      "Update local dev branch tracking: git branch --set-upstream-to=origin/main dev (or keep separate)",
      "Document the branch strategy in CLAUDE.md: main = release, dev = development",
      "Verify all CI/CD references (if any) point to the correct branch"
    ],
    "passes": false
  },
  {
    "description": "Align .gitignore: stop tracking personal governance state (.idumb/brain/) on dev, ensure .opencode/ deployment artifacts are also gitignored",
    "steps": [
      "Add .idumb/brain/ to .gitignore (state files are runtime-generated, not source code)",
      "Add .idumb/sessions/ to .gitignore (session tracking is runtime data)",
      "Add .idumb/logs/ to .gitignore (log files are runtime data)",
      "Keep .idumb/config.json tracked (user configuration is source-controlled)",
      "Keep .idumb/modules/ tracked (module templates are source-controlled for this repo)",
      "Add .opencode/agents/ and .opencode/commands/ to .gitignore (deployed artifacts, regenerated by init)",
      "Run git rm --cached for all newly-ignored files that are currently tracked",
      "Verify git status shows the files as deleted from index but still present on disk"
    ],
    "passes": false
  },
  {
    "description": "Remove personal brain data from git history: .idumb/brain/ contains 155KB of author's personal tasks/state that should not be in the repository",
    "steps": [
      "After aligning .gitignore (story 13-02), run git rm --cached -r .idumb/brain/ to remove brain data from the index",
      "Commit the removal: 'chore: remove personal governance state from tracking'",
      "Optionally: use git filter-branch or BFG Repo Cleaner to remove brain data from git history entirely (reduces repo size)",
      "Verify .idumb/brain/ files still exist on disk (only removed from git tracking)",
      "Verify the plugin still works correctly (persistence.ts reads from disk, not from git)"
    ],
    "passes": false
  },
  {
    "description": "Fix package.json for npm publish: workspaces field causes dashboard deps to interfere, postinstall is a no-op for consumers, files field includes non-existent bin/ directory, missing publishConfig",
    "steps": [
      "Remove or conditionally handle the workspaces field — dashboard frontend should not be installed as a workspace for consumers. Move it to devDependencies or exclude it from the published package",
      "Change postinstall from 'tsc || true' to something that only runs during development (or remove it — dist/ is pre-built by prepublishOnly)",
      "Update files field: remove 'bin' if bin/cli.mjs is a shim pointing to dist/ (or keep 'bin' and ensure it exists after build)",
      "Add publishConfig if needed for scoped publishing or access control",
      "Run npm pack --dry-run to verify the package contents are correct and minimal",
      "Verify the packed tarball includes dist/, bin/cli.mjs, README.md, LICENSE — and does NOT include src/dashboard/, .idumb/, .opencode/, planning/, docs/",
      "Verify npm run typecheck passes with zero errors"
    ],
    "passes": false
  }
]
