description = "Research how to implement a phase (standalone - usually use /gsd:plan-phase instead)"
prompt = "<objective>\nResearch how to implement a phase. Spawns gsd-phase-researcher agent with phase context.\n\n**Note:** This is a standalone research command. For most workflows, use `/gsd:plan-phase` which integrates research automatically.\n\n**Use this command when:**\n- You want to research without planning yet\n- You want to re-research after planning is complete\n- You need to investigate before deciding if a phase is feasible\n\n**Orchestrator role:** Parse phase, validate against roadmap, check existing research, gather context, spawn researcher agent, present results.\n\n**Why subagent:** Research burns context fast (WebSearch, Context7 queries, source verification). Fresh 200k context for investigation. Main context stays lean for user interaction.\n</objective>\n\n<context>\nPhase number: $ARGUMENTS (required)\n\nNormalize phase input in step 1 before any directory lookups.\n</context>\n\n<process>\n\n## 0. Resolve Model Profile\n\nRead model profile for agent spawning:\n\n```bash\nMODEL_PROFILE=$(cat .planning/config.json 2>/dev/null | grep -o '\"model_profile\"[[:space:]]*:[[:space:]]*\"[^\"]*\"' | grep -o '\"[^\"]*\"$' | tr -d '\"' || echo \"balanced\")\n```\n\nDefault to \"balanced\" if not set.\n\n**Model lookup table:**\n\n| Agent | quality | balanced | budget |\n|-------|---------|----------|--------|\n| gsd-phase-researcher | opus | sonnet | haiku |\n\nStore resolved model for use in Task calls below.\n\n## 1. Normalize and Validate Phase\n\n```bash\n# Normalize phase number (8 → 08, but preserve decimals like 2.1 → 02.1)\nif [[ \"$ARGUMENTS\" =~ ^[0-9]+$ ]]; then\n  PHASE=$(printf \"%02d\" \"$ARGUMENTS\")\nelif [[ \"$ARGUMENTS\" =~ ^([0-9]+)\\.([0-9]+)$ ]]; then\n  PHASE=$(printf \"%02d.%s\" \"${BASH_REMATCH[1]}\" \"${BASH_REMATCH[2]}\")\nelse\n  PHASE=\"$ARGUMENTS\"\nfi\n\ngrep -A5 \"Phase ${PHASE}:\" .planning/ROADMAP.md 2>/dev/null\n```\n\n**If not found:** Error and exit. **If found:** Extract phase number, name, description.\n\n## 2. Check Existing Research\n\n```bash\nls .planning/phases/${PHASE}-*/RESEARCH.md 2>/dev/null\n```\n\n**If exists:** Offer: 1) Update research, 2) View existing, 3) Skip. Wait for response.\n\n**If doesn't exist:** Continue.\n\n## 3. Gather Phase Context\n\n```bash\ngrep -A20 \"Phase ${PHASE}:\" .planning/ROADMAP.md\ncat .planning/REQUIREMENTS.md 2>/dev/null\ncat .planning/phases/${PHASE}-*/*-CONTEXT.md 2>/dev/null\ngrep -A30 \"### Decisions Made\" .planning/STATE.md 2>/dev/null\n```\n\nPresent summary with phase description, requirements, prior decisions.\n\n## 4. Spawn gsd-phase-researcher Agent\n\nResearch modes: ecosystem (default), feasibility, implementation, comparison.\n\n```markdown\n<research_type>\nPhase Research — investigating HOW to implement a specific phase well.\n</research_type>\n\n<key_insight>\nThe question is NOT \"which library should I use?\"\n\nThe question is: \"What do I not know that I don't know?\"\n\nFor this phase, discover:\n- What's the established architecture pattern?\n- What libraries form the standard stack?\n- What problems do people commonly hit?\n- What's SOTA vs what Claude's training thinks is SOTA?\n- What should NOT be hand-rolled?\n</key_insight>\n\n<objective>\nResearch implementation approach for Phase {phase_number}: {phase_name}\nMode: ecosystem\n</objective>\n\n<context>\n**Phase description:** {phase_description}\n**Requirements:** {requirements_list}\n**Prior decisions:** {decisions_if_any}\n**Phase context:** {context_md_content}\n</context>\n\n<downstream_consumer>\nYour RESEARCH.md will be loaded by `/gsd:plan-phase` which uses specific sections:\n- `## Standard Stack` → Plans use these libraries\n- `## Architecture Patterns` → Task structure follows these\n- `## Don't Hand-Roll` → Tasks NEVER build custom solutions for listed problems\n- `## Common Pitfalls` → Verification steps check for these\n- `## Code Examples` → Task actions reference these patterns\n\nBe prescriptive, not exploratory. \"Use X\" not \"Consider X or Y.\"\n</downstream_consumer>\n\n<quality_gate>\nBefore declaring complete, verify:\n- [ ] All domains investigated (not just some)\n- [ ] Negative claims verified with official docs\n- [ ] Multiple sources for critical claims\n- [ ] Confidence levels assigned honestly\n- [ ] Section names match what plan-phase expects\n</quality_gate>\n\n<output>\nWrite to: .planning/phases/${PHASE}-{slug}/${PHASE}-RESEARCH.md\n</output>\n```\n\n```\nTask(\n  prompt=\"First, read ./.gemini/agents/gsd-phase-researcher.md for your role and instructions.\\n\\n\" + filled_prompt,\n  subagent_type=\"general-purpose\",\n  model=\"{researcher_model}\",\n  description=\"Research Phase {phase}\"\n)\n```\n\n## 5. Handle Agent Return\n\n**`## RESEARCH COMPLETE`:** Display summary, offer: Plan phase, Dig deeper, Review full, Done.\n\n**`## CHECKPOINT REACHED`:** Present to user, get response, spawn continuation.\n\n**`## RESEARCH INCONCLUSIVE`:** Show what was attempted, offer: Add context, Try different mode, Manual.\n\n## 6. Spawn Continuation Agent\n\n```markdown\n<objective>\nContinue research for Phase {phase_number}: {phase_name}\n</objective>\n\n<prior_state>\nResearch file: @.planning/phases/${PHASE}-{slug}/${PHASE}-RESEARCH.md\n</prior_state>\n\n<checkpoint_response>\n**Type:** {checkpoint_type}\n**Response:** {user_response}\n</checkpoint_response>\n```\n\n```\nTask(\n  prompt=\"First, read ./.gemini/agents/gsd-phase-researcher.md for your role and instructions.\\n\\n\" + continuation_prompt,\n  subagent_type=\"general-purpose\",\n  model=\"{researcher_model}\",\n  description=\"Continue research Phase {phase}\"\n)\n```\n\n</process>\n\n<success_criteria>\n- [ ] Phase validated against roadmap\n- [ ] Existing research checked\n- [ ] gsd-phase-researcher spawned with context\n- [ ] Checkpoints handled correctly\n- [ ] User knows next steps\n</success_criteria>"
