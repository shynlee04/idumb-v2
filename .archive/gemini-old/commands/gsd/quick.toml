description = "Execute a quick task with GSD guarantees (atomic commits, state tracking) but skip optional agents"
prompt = "<objective>\nExecute small, ad-hoc tasks with GSD guarantees (atomic commits, STATE.md tracking) while skipping optional agents (research, plan-checker, verifier).\n\nQuick mode is the same system with a shorter path:\n- Spawns gsd-planner (quick mode) + gsd-executor(s)\n- Skips gsd-phase-researcher, gsd-plan-checker, gsd-verifier\n- Quick tasks live in `.planning/quick/` separate from planned phases\n- Updates STATE.md \"Quick Tasks Completed\" table (NOT ROADMAP.md)\n\nUse when: You know exactly what to do and the task is small enough to not need research or verification.\n</objective>\n\n<execution_context>\nOrchestration is inline - no separate workflow file. Quick mode is deliberately simpler than full GSD.\n</execution_context>\n\n<context>\n@.planning/STATE.md\n</context>\n\n<process>\n**Step 0: Resolve Model Profile**\n\nRead model profile for agent spawning:\n\n```bash\nMODEL_PROFILE=$(cat .planning/config.json 2>/dev/null | grep -o '\"model_profile\"[[:space:]]*:[[:space:]]*\"[^\"]*\"' | grep -o '\"[^\"]*\"$' | tr -d '\"' || echo \"balanced\")\n```\n\nDefault to \"balanced\" if not set.\n\n**Model lookup table:**\n\n| Agent | quality | balanced | budget |\n|-------|---------|----------|--------|\n| gsd-planner | opus | opus | sonnet |\n| gsd-executor | opus | sonnet | sonnet |\n\nStore resolved models for use in Task calls below.\n\n---\n\n**Step 1: Pre-flight validation**\n\nCheck that an active GSD project exists:\n\n```bash\nif [ ! -f .planning/ROADMAP.md ]; then\n  echo \"Quick mode requires an active project with ROADMAP.md.\"\n  echo \"Run /gsd:new-project first.\"\n  exit 1\nfi\n```\n\nIf validation fails, stop immediately with the error message.\n\nQuick tasks can run mid-phase - validation only checks ROADMAP.md exists, not phase status.\n\n---\n\n**Step 2: Get task description**\n\nPrompt user interactively for the task description:\n\n```\nAskUserQuestion(\n  header: \"Quick Task\",\n  question: \"What do you want to do?\",\n  followUp: null\n)\n```\n\nStore response as `$DESCRIPTION`.\n\nIf empty, re-prompt: \"Please provide a task description.\"\n\nGenerate slug from description:\n```bash\nslug=$(echo \"$DESCRIPTION\" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9]/-/g' | sed 's/--*/-/g' | sed 's/^-//;s/-$//' | cut -c1-40)\n```\n\n---\n\n**Step 3: Calculate next quick task number**\n\nEnsure `.planning/quick/` directory exists and find the next sequential number:\n\n```bash\n# Ensure .planning/quick/ exists\nmkdir -p .planning/quick\n\n# Find highest existing number and increment\nlast=$(ls -1d .planning/quick/[0-9][0-9][0-9]-* 2>/dev/null | sort -r | head -1 | xargs -I{} basename {} | grep -oE '^[0-9]+')\n\nif [ -z \"$last\" ]; then\n  next_num=\"001\"\nelse\n  next_num=$(printf \"%03d\" $((10#$last + 1)))\nfi\n```\n\n---\n\n**Step 4: Create quick task directory**\n\nCreate the directory for this quick task:\n\n```bash\nQUICK_DIR=\".planning/quick/${next_num}-${slug}\"\nmkdir -p \"$QUICK_DIR\"\n```\n\nReport to user:\n```\nCreating quick task ${next_num}: ${DESCRIPTION}\nDirectory: ${QUICK_DIR}\n```\n\nStore `$QUICK_DIR` for use in orchestration.\n\n---\n\n**Step 5: Spawn planner (quick mode)**\n\nSpawn gsd-planner with quick mode context:\n\n```\nTask(\n  prompt=\"\n<planning_context>\n\n**Mode:** quick\n**Directory:** ${QUICK_DIR}\n**Description:** ${DESCRIPTION}\n\n**Project State:**\n@.planning/STATE.md\n\n</planning_context>\n\n<constraints>\n- Create a SINGLE plan with 1-3 focused tasks\n- Quick tasks should be atomic and self-contained\n- No research phase, no checker phase\n- Target ~30% context usage (simple, focused)\n</constraints>\n\n<output>\nWrite plan to: ${QUICK_DIR}/${next_num}-PLAN.md\nReturn: ## PLANNING COMPLETE with plan path\n</output>\n\",\n  subagent_type=\"gsd-planner\",\n  model=\"{planner_model}\",\n  description=\"Quick plan: ${DESCRIPTION}\"\n)\n```\n\nAfter planner returns:\n1. Verify plan exists at `${QUICK_DIR}/${next_num}-PLAN.md`\n2. Extract plan count (typically 1 for quick tasks)\n3. Report: \"Plan created: ${QUICK_DIR}/${next_num}-PLAN.md\"\n\nIf plan not found, error: \"Planner failed to create ${next_num}-PLAN.md\"\n\n---\n\n**Step 6: Spawn executor**\n\nSpawn gsd-executor with plan reference:\n\n```\nTask(\n  prompt=\"\nExecute quick task ${next_num}.\n\nPlan: @${QUICK_DIR}/${next_num}-PLAN.md\nProject state: @.planning/STATE.md\n\n<constraints>\n- Execute all tasks in the plan\n- Commit each task atomically\n- Create summary at: ${QUICK_DIR}/${next_num}-SUMMARY.md\n- Do NOT update ROADMAP.md (quick tasks are separate from planned phases)\n</constraints>\n\",\n  subagent_type=\"gsd-executor\",\n  model=\"{executor_model}\",\n  description=\"Execute: ${DESCRIPTION}\"\n)\n```\n\nAfter executor returns:\n1. Verify summary exists at `${QUICK_DIR}/${next_num}-SUMMARY.md`\n2. Extract commit hash from executor output\n3. Report completion status\n\nIf summary not found, error: \"Executor failed to create ${next_num}-SUMMARY.md\"\n\nNote: For quick tasks producing multiple plans (rare), spawn executors in parallel waves per execute-phase patterns.\n\n---\n\n**Step 7: Update STATE.md**\n\nUpdate STATE.md with quick task completion record.\n\n**7a. Check if \"Quick Tasks Completed\" section exists:**\n\nRead STATE.md and check for `### Quick Tasks Completed` section.\n\n**7b. If section doesn't exist, create it:**\n\nInsert after `### Blockers/Concerns` section:\n\n```markdown\n### Quick Tasks Completed\n\n| # | Description | Date | Commit | Directory |\n|---|-------------|------|--------|-----------|\n```\n\n**7c. Append new row to table:**\n\n```markdown\n| ${next_num} | ${DESCRIPTION} | $(date +%Y-%m-%d) | ${commit_hash} | [${next_num}-${slug}](./quick/${next_num}-${slug}/) |\n```\n\n**7d. Update \"Last activity\" line:**\n\nFind and update the line:\n```\nLast activity: $(date +%Y-%m-%d) - Completed quick task ${next_num}: ${DESCRIPTION}\n```\n\nUse Edit tool to make these changes atomically\n\n---\n\n**Step 8: Final commit and completion**\n\nStage and commit quick task artifacts:\n\n```bash\n# Stage quick task artifacts\ngit add ${QUICK_DIR}/${next_num}-PLAN.md\ngit add ${QUICK_DIR}/${next_num}-SUMMARY.md\ngit add .planning/STATE.md\n\n# Commit with quick task format\ngit commit -m \"$(cat <<'EOF'\ndocs(quick-${next_num}): ${DESCRIPTION}\n\nQuick task completed.\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n)\"\n```\n\nGet final commit hash:\n```bash\ncommit_hash=$(git rev-parse --short HEAD)\n```\n\nDisplay completion output:\n```\n---\n\nGSD > QUICK TASK COMPLETE\n\nQuick Task ${next_num}: ${DESCRIPTION}\n\nSummary: ${QUICK_DIR}/${next_num}-SUMMARY.md\nCommit: ${commit_hash}\n\n---\n\nReady for next task: /gsd:quick\n```\n\n</process>\n\n<success_criteria>\n- [ ] ROADMAP.md validation passes\n- [ ] User provides task description\n- [ ] Slug generated (lowercase, hyphens, max 40 chars)\n- [ ] Next number calculated (001, 002, 003...)\n- [ ] Directory created at `.planning/quick/NNN-slug/`\n- [ ] `${next_num}-PLAN.md` created by planner\n- [ ] `${next_num}-SUMMARY.md` created by executor\n- [ ] STATE.md updated with quick task row\n- [ ] Artifacts committed\n</success_criteria>"
