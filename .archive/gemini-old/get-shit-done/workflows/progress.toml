prompt = "<purpose>\nCheck project progress, summarize recent work, and route to the next action.\n\nProvides situational awareness before continuing work.\n</purpose>\n\n<process>\n\n## Step 1: Verify Planning Structure\n\n```bash\ntest -d .planning && echo \"exists\" || echo \"missing\"\n```\n\nIf no `.planning/`:\n```\nNo planning structure found.\nRun /gsd:new-project to start a new project.\n```\nExit.\n\nIf missing STATE.md: suggest `/gsd:new-project`.\n\nIf ROADMAP.md missing but PROJECT.md exists: Route F (between milestones).\n\n## Step 2: Load Context\n\nRead:\n- `.planning/STATE.md`\n- `.planning/ROADMAP.md`\n- `.planning/PROJECT.md`\n- `.planning/config.json`\n\n## Step 3: Gather Recent Work\n\nFind the 2-3 most recent SUMMARY.md files.\nExtract what was accomplished, key decisions, any issues.\n\n## Step 4: Parse Current Position\n\nFrom STATE.md: current phase, plan number, status.\n\nCalculate: total plans, completed plans, remaining plans.\n\nCheck for:\n- CONTEXT.md in phase directory\n- Pending todos: `ls .planning/todos/pending/*.md 2>/dev/null | wc -l`\n- Active debug sessions: `ls .planning/debug/*.md 2>/dev/null | grep -v resolved | wc -l`\n\n## Step 5: Present Status Report\n\n```\n# [Project Name]\n\n**Progress:** [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 8/10 plans complete\n**Profile:** [quality/balanced/budget]\n\n## Recent Work\n- [Phase X, Plan Y]: [accomplishment]\n- [Phase X, Plan Z]: [accomplishment]\n\n## Current Position\nPhase [N] of [total]: [phase-name]\nPlan [M] of [phase-total]: [status]\nCONTEXT: [âœ“ if exists | - if not]\n\n## Key Decisions Made\n- [decision 1]\n- [decision 2]\n\n## Blockers/Concerns\n- [any blockers from STATE.md]\n\n## Pending Todos\n- [count] pending â€” /gsd:check-todos to review\n\n## Active Debug Sessions\n- [count] active â€” /gsd:debug to continue\n(Only if count > 0)\n\n## What's Next\n[Next phase/plan objective]\n```\n\n## Step 6: Route to Next Action\n\n**Count files in current phase:**\n```bash\nls -1 .planning/phases/[phase-dir]/*-PLAN.md 2>/dev/null | wc -l\nls -1 .planning/phases/[phase-dir]/*-SUMMARY.md 2>/dev/null | wc -l\nls -1 .planning/phases/[phase-dir]/*-UAT.md 2>/dev/null | wc -l\n```\n\n**Check for UAT gaps:**\n```bash\ngrep -l \"status: diagnosed\" .planning/phases/[phase-dir]/*-UAT.md 2>/dev/null\n```\n\n**Route based on state:**\n\n| Condition | Route |\n|-----------|-------|\n| uat_with_gaps > 0 | Route E â€” UAT gaps need fix plans |\n| summaries < plans | Route A â€” Unexecuted plans exist |\n| summaries = plans AND plans > 0 | Step 7 â€” Check milestone status |\n| plans = 0 | Route B â€” Phase needs planning |\n\n</process>\n\n<routes>\n\n## Route A: Unexecuted plan exists\n\nFind first PLAN.md without matching SUMMARY.md.\n\n```\n## â–¶ Next Up\n\n**{phase}-{plan}: [Plan Name]** â€” [objective]\n\n/gsd:execute-phase {phase}\n\n*(/clear first â†’ fresh context window)*\n```\n\n## Route B: Phase needs planning\n\n**If CONTEXT.md exists:**\n```\n## â–¶ Next Up\n\n**Phase {N}: {Name}** â€” {Goal}\n*(âœ“ Context gathered, ready to plan)*\n\n/gsd:plan-phase {phase-number}\n```\n\n**If CONTEXT.md does NOT exist:**\n```\n## â–¶ Next Up\n\n**Phase {N}: {Name}** â€” {Goal}\n\n/gsd:discuss-phase {phase} â€” gather context and clarify approach\n\n---\n\n**Also available:**\n- /gsd:plan-phase {phase} â€” skip discussion, plan directly\n- /gsd:list-phase-assumptions {phase} â€” see Claude's assumptions\n```\n\n## Route C: Phase complete, more phases remain\n\n```\n## âœ“ Phase {Z} Complete\n\n## â–¶ Next Up\n\n**Phase {Z+1}: {Name}** â€” {Goal}\n\n/gsd:discuss-phase {Z+1}\n\n---\n\n**Also available:**\n- /gsd:plan-phase {Z+1} â€” skip discussion\n- /gsd:verify-work {Z} â€” acceptance test before continuing\n```\n\n## Route D: Milestone complete\n\n```\n## ðŸŽ‰ Milestone Complete\n\nAll {N} phases finished!\n\n## â–¶ Next Up\n\n**Complete Milestone** â€” archive and prepare for next\n\n/gsd:complete-milestone\n\n---\n\n**Also available:**\n- /gsd:verify-work â€” acceptance test before completing\n```\n\n## Route E: UAT gaps need fix plans\n\n```\n## âš  UAT Gaps Found\n\n**{phase}-UAT.md** has {N} gaps requiring fixes.\n\n/gsd:plan-phase {phase} --gaps\n\n---\n\n**Also available:**\n- /gsd:execute-phase {phase} â€” execute existing plans\n- /gsd:verify-work {phase} â€” run more UAT testing\n```\n\n## Route F: Between milestones\n\n```\n## âœ“ Milestone v{X.Y} Complete\n\nReady to plan the next milestone.\n\n## â–¶ Next Up\n\n**Start Next Milestone** â€” questioning â†’ research â†’ requirements â†’ roadmap\n\n/gsd:new-milestone\n```\n\n</routes>\n\n<step7_milestone_check>\nWhen phase complete (summaries = plans AND plans > 0):\n\nRead ROADMAP.md, identify current and highest phase numbers.\n\n| Condition | Route |\n|-----------|-------|\n| current < highest | Route C â€” More phases remain |\n| current = highest | Route D â€” Milestone complete |\n</step7_milestone_check>\n"
