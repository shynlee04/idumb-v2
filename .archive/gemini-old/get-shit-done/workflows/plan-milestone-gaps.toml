prompt = "<purpose>\nCreate all phases necessary to close gaps identified by `/gsd:audit-milestone`.\n\nOne command creates all fix phases — no manual `/gsd:add-phase` per gap.\n</purpose>\n\n<process>\n\n## Step 1: Load Audit Results\n\n```bash\nls -t .planning/v*-MILESTONE-AUDIT.md 2>/dev/null | head -1\n```\n\nParse YAML frontmatter:\n- `gaps.requirements` — unsatisfied requirements\n- `gaps.integration` — missing cross-phase connections\n- `gaps.flows` — broken E2E flows\n\nError if no audit file or no gaps:\n```\nNo audit gaps found. Run /gsd:audit-milestone first.\n```\n\n## Step 2: Prioritize Gaps\n\nGroup by priority from REQUIREMENTS.md:\n\n| Priority | Action |\n|----------|--------|\n| `must` | Create phase, blocks milestone |\n| `should` | Create phase, recommended |\n| `nice` | Ask user: include or defer? |\n\n## Step 3: Group Gaps into Phases\n\nCluster related gaps:\n- Same affected phase → combine\n- Same subsystem (auth, API, UI) → combine\n- Dependency order (fix stubs before wiring)\n- Keep phases focused: 2-4 tasks each\n\n## Step 4: Determine Phase Numbers\n\n```bash\nls -d .planning/phases/*/ | sort -V | tail -1\n```\n\nNew phases continue from highest existing.\n\n## Step 5: Present Gap Closure Plan\n\n```markdown\n## Gap Closure Plan\n\n**Milestone:** {version}\n**Gaps to close:** {N} requirements, {M} integration, {K} flows\n\n### Proposed Phases\n\n**Phase {N}: {Name}**\nCloses:\n- {REQ-ID}: {description}\n- Integration: {from} → {to}\n\n{If nice-to-have gaps:}\n\n### Deferred (nice-to-have)\nThese gaps are optional. Include them?\n\n---\n\nCreate these {X} phases? (yes / adjust / defer optional)\n```\n\n## Step 6: Update ROADMAP.md\n\nAdd phases with gap closure context:\n\n```markdown\n### Phase {N}: {Name}\n**Goal:** {derived from gaps}\n**Requirements:** {REQ-IDs}\n**Gap Closure:** Closes gaps from audit\n```\n\n## Step 7: Create Phase Directories\n\n```bash\nmkdir -p \".planning/phases/{NN}-{name}\"\n```\n\n## Step 8: Commit\n\n@./.gemini/get-shit-done/references/git-planning-commit.md\n\n## Step 9: Offer Next Steps\n\n```\n## ✓ Gap Closure Phases Created\n\n**Phases added:** {N} - {M}\n**Gaps addressed:** {count} requirements, {count} integration, {count} flows\n\n---\n\n## ▶ Next Up\n\n**Plan first gap closure phase**\n\n/gsd:plan-phase {N}\n\n---\n\n**After all gap phases complete:**\n/gsd:audit-milestone — re-audit to verify gaps closed\n```\n\n</process>\n"
